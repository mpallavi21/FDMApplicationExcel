//USEUNIT ClientLoginModule
//USEUNIT STDLib
//USEUNIT NetworkTreeViewPage
//USEUNIT ClientLoginModule
//USEUNIT FDMCommonPage
//USEUNIT DeviceStateViewPage
//USEUNIT SettingsPage
//USEUNIT GenericMethods
//USEUNIT EntryPointPage

function launchFDMClientApplication(ServerName, Username, Password) {
  Log.AppendFolder("launchFDMClientApplication");

  let status = "Pass";

  try {
    launchFDMClient(ServerName, Username, Password);
  } catch (e) {
    Log.Error("launchFDMClientApplication failed: " + e.message);
    status = "Fail";
  }

  WriteResult("launchFDMClientApplication " + status, status, "Pass");

  Log.PopLogFolder();
}


function terminateFDMClientApplication() {
  Log.AppendFolder("terminateFDMClientApplication");

  let status = "Pass";

  try {
    terminateFMDClient();
  } catch (e) {
    Log.Error("terminateFDMClientApplication failed: " + e.message);
    status = "Fail";
  }

  WriteResult("terminateFDMClientApplication " + status, status, "Pass");

  Log.PopLogFolder();
}



// =====================================================================
// Author:        Bharath
// Function:      FDMGR3890
// Description:   Executes the Build Network operation on the Mux node
//                as part of test cases FDMGR3890 and FDMGR3891
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR3890() {
  try {
    Log.AppendFolder(" FDMGR3890 - Executes the Build Network operation on the Mux node as part of test cases FDMGR3890")
   // launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    clickOnNetworkViewTab()
    clickOnbuildNetwork("|FDM Server ( DESKTOP-AJ7O5O5 )|DESKTOP-AJ7O5O5|MUX");
    clickOnbuildNetwork("|FDM Server ( DESKTOP-AJ7O5O5 )|DESKTOP-AJ7O5O5|MUX|SFT_PNF");
    Log.Checkpoint("FDMGR3890 executed successfully.");
  } catch (error) {
    Log.Error("Error occurred in FDMGR3890:", error);
  } finally {
    Log.PopLogFolder()
  }
}


// =====================================================================
// Author:        Bharath
// Function:      FDMGR3891
// Description:   Executes the Build Network operation on the Mux node
//                as part of test case FDMGR3891
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR3891() {
  try {
    Log.AppendFolder(" FDMGR3891 - Executes the Build Network operation on the Mux node as part of test cases FDMGR3891")
   // launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    clickOnNetworkViewTab()
    clickOnbuildNetwork("|FDM Server ( DESKTOP-AJ7O5O5 )|DESKTOP-AJ7O5O5|MUX");
    clickOnbuildNetwork("|FDM Server ( DESKTOP-AJ7O5O5 )|DESKTOP-AJ7O5O5|MUX|SFT_PNF");
    Log.Checkpoint("FDMGR3891 executed successfully.");
  } catch (error) {
    Log.Error("Error occurred in FDMGR3891:", error);
  } finally {
    Log.PopLogFolder()
  }
}

// =====================================================================
// Author:        Bharath
// Function:      FDMGR6060
// Description:   Verifies the FDM device R3051Rev10H7 under Mux shows
//                the expected OCR status text "*Good*"
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR6060() {
  try {
    Log.AppendFolder("FDMGR6060 - Verifies the FDM device under Mux shows")
      //  launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    verifyFDMDeviceStatus(Project.Variables.Device);
    CloseWindow()
    clickOnConfirmFDMButton()
    // TestedApps.HCMClient.Terminate();
    Log.Checkpoint("FDMGR6060 passed: Device status verified.");
  } catch (error) {
    Log.Error("FDMGR6060 failed during device status verification:", error);
  } finally{
    Log.PopLogFolder()
  }
}

// =====================================================================
// Author:        Bharath
// Function:      FDMGR6061
// Description:   Verifies the FDM device R3051Rev10H7 under Mux shows
//                the expected OCR status text "*Good*"
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR6061() {
  try {
    Log.AppendFolder("FDMGR6061 - Verifies the FDM device under Mux shows")
      //  launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    verifyFDMDeviceStatus(Project.Variables.Device);
    CloseWindow()
    clickOnConfirmFDMButton()
    // TestedApps.HCMClient.Terminate();
    Log.Checkpoint("FDMGR6061 passed: Device status verified.");
  } catch (error) {
    Log.Error("FDMGR6061 failed during device status verification:", error);
  } finally{
    Log.PopLogFolder()
  }
}


// =====================================================================
// Author:        Bharath
// Function:      FDMGR5956
// Description:   validate FDM device property option in entry point screen
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR5956() {
  try {
    Log.AppendFolder("FDMGR5956 - validate FDM device property option in entry point screen")
      //  launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    clickOnDevice(`${Project.Variables.Device}`);
    let adornerDecorator = Aliases.HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage.EntryPointsTabPage.HwndSource_AdornerDecorator.AdornerDecorator;
    aqObject.CheckProperty(adornerDecorator.HyperlinkFdmDeviceProperties, "WPFControlText", cmpEqual, "FDM Device properties");
    CloseWindow()
    clickOnConfirmFDMButton()
    // TestedApps.HCMClient.Terminate();
    Log.Checkpoint("FDMGR5956 passed: Device status verified.");
    
  } catch (error) {
    Log.Error("FDMGR5956 failed during device status verification:", error);
  } finally{
    Log.PopLogFolder()
  }
}

// =====================================================================
// Author:        Bharath
// Function:      FDMGR5957
// Description:   validate FDM device property option in entry point screen
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR5957() {
  try {
    Log.AppendFolder("FDMGR5957 - validate FDM device property option in entry point screen")
      //  launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    clickOnDevice(`${Project.Variables.Device}`);
    let adornerDecorator = Aliases.HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage.EntryPointsTabPage.HwndSource_AdornerDecorator.AdornerDecorator;
    aqObject.CheckProperty(adornerDecorator.HyperlinkFdmDeviceProperties, "WPFControlText", cmpEqual, "FDM Device properties");
    CloseWindow()
    clickOnConfirmFDMButton()
    // TestedApps.HCMClient.Terminate();
    Log.Checkpoint("FDMGR5957 passed: Device status verified.");
    
  } catch (error) {
    Log.Error("FDMGR5957 failed during device status verification:", error);
  } finally{
    Log.PopLogFolder()
  }
}

function QuickViewOfDevice(Device) {
  Log.AppendFolder("QuickViewOfDevice - Verify Quick View Launch and Log Device Info");

  let status = "Pass";

  try {
    // Step 1: Verify Quick View launches for the device
    verifyQuickViewLaunch(Device);

    // Step 2: Log diagnostic/device information
    logFDMDeviceInformation();
    
    closeWindowPage()

    Log.Checkpoint("✅ QuickViewOfDevice passed: Quick View verified and device info logged.");
  } catch (error) {
    Log.Error("❌ QuickViewOfDevice failed during Quick View verification or logging: " + error.message);
    status = "Fail";
  } finally {
    WriteResult("QuickViewOfDevice " + status, status, "Pass");
    Log.PopLogFolder();
  }
}



// =====================================================================
// Author:        Bharath
// Function:      FDMGR5900
// Description:   Verifies that Quick View launches for a specific FDM device
//                and checks the device status using FDMDeviceStatus()
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR5900() {
  try {
    Log.AppendFolder("FDMGR5900 - Verify Quick View and Device Status");
    
    // Step 1: Launch and verify Quick View
    verifyQuickViewLaunch(Project.Variables.Device);

    // Step 2: Check the device status
    FDMDeviceStatus();

    Log.Checkpoint("✅ FDMGR5900 passed: Quick View launched and device status verified.");
  } catch (error) {
    Log.Error("❌ FDMGR5900 failed during Quick View or device status check:", error);
  } finally {
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      FDMGR4904
// Description:   Verify all created history for the device in "View history"
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function FDMGR4904() {
  try {
    Log.AppendFolder(`FDMGR5900 - Verify all created history for the device in "View history"`);
    
    //Launch and verify History
    LaunchViewHistory(Project.Variables.Device);
    
    Log.Checkpoint("✅ FDMGR5900 passed: View History launched");
  } catch (error) {
    Log.Error("❌ FDMGR5900 failed during View History:- ", error);
  } finally {
    Log.PopLogFolder();
  }
}



// =====================================================================
// Author:        Bharath
// Function:      AuditTrail
// Description:   Triggers audit trail view for a selected tooltip,
//                applies 'All' filters and clicks the 'View' button.
// Created On:    21-Jul-2025
// Modified On:   21-Jul-2025
// =====================================================================

function ViewAuditTrailForDevice(targetItem, ActionType) {
  Log.AppendFolder("ViewAuditTrailForDevice - Audit Trail Flow");

  let status = "Pass";

  try {
    let treeView = Aliases.HCMClient.ClientMainWindow.panelLeftPanMain.tabControlLeftPanMain.tabPageOnlineView.panelOnlineView.panelTabControlOnlineView.tabControlOnlineView.tabConnected.treeView;

    treeView.ClickItemR(targetItem);
    Log.Message("Right-clicked item for context menu.");
    Delay(1000);

    treeView.StripPopupMenu.Click("View Audit Trail");

    // Apply filters in Audit Trail view
    let groupBox = Aliases.HCMClient.ClientMainWindow.MdiClient.AuditTrailView.panelBase.panelForDerivedForms.panel4.panel2.groupBox1;

    if (groupBox.Exists) {
      let listBox = groupBox.ActionTypeListBox;
      listBox.ClickItem(ActionType);
      OCR.Recognize(groupBox.ViewButton).BlockByText("View").Click();
      Delay(1000);
      Log.Message("Applied filters and clicked View in Audit Trail.");
    } else {
      throw new Error("Audit Trail group box not found.");
    }

    closeWindowPage()

  } catch (e) {
    Log.Error("Exception in ViewAuditTrailForDevice: " + e.message);
    status = "Fail";
  }

  WriteResult("ViewAuditTrailForDevice " + status, status, "Pass");
  Log.PopLogFolder();
}


// =====================================================================
// Author:        Bharath
// Function:      auditTrail15687
// Description:   Configures audit trail settings, opens the audit trail viewer,
//                and filters action types for complete visibility.
// Created On:    22-Aug-2025
// Modified On:   22-Aug-2025
// =====================================================================

function auditTrailViaMenuTab() {
  Log.AppendFolder("auditTrailViaMenuTab");

  let status = "Pass";

  try {
    // Step 1: Open FDM toolbar settings and navigate to Audit Trail tab
    openFDMToolBarSettings();

    let HCMClient = Aliases.HCMClient;
    let settingsForm = HCMClient.SettingsForm;
    let tabControl = settingsForm.tabControl1;

    tabControl.ClickTab("Audit Trail");
    let groupBox = tabControl.tabPageAuditTrail.gbAuditTrailActions;

    // Step 2: Toggle 'All' checkbox to refresh audit trail view
    groupBox.checkBoxAll.wState = cbChecked;
    groupBox.checkBoxAll.wState = cbUnchecked;

    // Step 3: Interact with audit trail grid to activate selection
    let fpSpread = groupBox.fpAuditTrail;
    fpSpread.Click(237, 33);
    fpSpread.Click(237, 33);  // Double-click to ensure selection

    // Step 4: Confirm settings
    OCR.Recognize(settingsForm.buttonOK).BlockByText("OK").Click();

    // Step 5: Open Audit Trail viewer from main menu
    let frmHCMClientMain = HCMClient.ClientMainWindow;
    let smartMenuBar = frmHCMClientMain.mainMenu;

    OCR.Recognize(smartMenuBar).BlockByText("View").Click();
    let subSmartControl = HCMClient.DropDownForm.SubSmartControl;
    OCR.Recognize(subSmartControl).BlockByText("Audit Trail").Click();

    // Step 6: Trigger audit trail view for selected device
    frmHCMClientMain.panelLeftPanMain.tabControlLeftPanMain.tabPageOnlineView
      .panelOnlineView.panelTabControlOnlineView.tabControlOnlineView.tabConnected.Keys("[Right][Enter]");

    // Step 7: Filter audit trail by action type
    let panel = frmHCMClientMain.MdiClient.AuditTrailView.panelBase.panelForDerivedForms.panel4.panel2;
    groupBox = panel.groupBox1;

    groupBox.ActionTypeListBox.ClickItem("---All---");
    OCR.Recognize(groupBox.ViewButton).BlockByText("View").Click();

    // Step 8: Final cleanup
    closeWindowPage();

  } catch (error) {
    Log.Error("Error in auditTrailViaMenuTab: " + error.message);
    status = "Fail";
  }

  WriteResult("auditTrailViaMenuTab " + status, status, "Pass");
  Log.PopLogFolder();
}

 
  


// =====================================================================
// Author:        Bharath
// Function:      BuildNetwork
// Description:   Executes the Build Network operation on the Mux node
//                as part of test cases FDMGR3890 and FDMGR3891
// Created On:    2025-06-20
// Modified On:   None
// =====================================================================

function BuildNetwork(NetworkName,timeOut) {
  Log.AppendFolder("BuildNetwork - Executes the Build Network operation on the Mux node as part of test cases BuildNetwork_HW Mux");

  let status = "Pass";

  try {
    ClickOnlineViewTab();
    clickOnNetworkViewTab();
    clickOnbuildNetwork(NetworkName,timeOut);

    Log.Checkpoint("BuildNetwork executed successfully.");
  } catch (error) {
    Log.Error("Error occurred in BuildNetwork: " + error.message);
    status = "Fail";
  } finally {
    WriteResult("BuildNetwork " + status, status, "Pass");
    Log.PopLogFolder();
  }
}



// =====================================================================
// Author:        Bharath
// Function:      Device_Explicit_Lock
// Description:   Locks a device, attempts configuration, handles warning, unlocks, and retries configuration.
// Created On:    04-Aug-2025
// Modified On:   
// =====================================================================

function Device_Explicit_Lock() {
  Log.AppendFolder("Device_Explicit_Lock");

  try {
    
    //launchFDMClient(Project.Variables.FDMClientUserName,Project.Variables.FDMClientPassword)
    ClickOnlineViewTab()
    
    // Step 1: Open Network View
    clickOnNetworkViewTab();

    // Step 2: Access the tree view
    let treeView = Aliases.HCMClient.ClientMainWindow.panelLeftPanMain
                     .tabControlLeftPanMain.tabPageOnlineView.panelOnlineView
                     .panelTabControlOnlineView.tabControlOnlineView.tabConnected.treeView;

    if (!treeView.Exists) {
      Log.Error("❌ TreeView not found.");
      return;
    }

    // Step 3: Lock the device
    let targetItem = Project.Variables.Device;
    treeView.ClickItem(targetItem);
    Log.Message("🔒 Clicking item: " + targetItem);

    treeView.ClickItemR(targetItem);
    Delay(1000);
    treeView.StripPopupMenu.Click("Lock");

    // Step 4: Attempt configuration (locked state)
    let lockedItemPath = Project.Variables.Device;
    treeView.ClickItemR(lockedItemPath);
    treeView.StripPopupMenu.Click("Configure with|DTM (Online)");

    // Step 5: Handle warning dialog
    Delay(2000)
    let HCMClient = Aliases.HCMClient;
    HCMClient.dlgFDMConfiguration.btnOK.ClickButton();

    // Step 6: Unlock and retry configuration
    let frmHCMClientMain = HCMClient.ClientMainWindow;
    treeView = frmHCMClientMain.panelLeftPanMain.tabControlLeftPanMain
                .tabPageOnlineView.panelOnlineView.panelTabControlOnlineView
                .tabControlOnlineView.tabConnected.treeView;

    treeView.ClickItemR(lockedItemPath);
    treeView.StripPopupMenu.Click("Unlock");
    treeView.ClickItemR(lockedItemPath);
    treeView.StripPopupMenu.Click("Configure with|DTM (Online)");

    // Step 7: Confirm successful configuration
    let hostPanel = frmHCMClientMain.MdiClient.DtmForm.panelBase;
    aqObject.CheckProperty(hostPanel.panelForDerivedForms.DTMTabView.panelConfiguration.tabControl1,
      "Enabled", cmpEqual, true);
    hostPanel.panelFullTop.panelTitle.buttonClose.Click(11, 9);

    // Step 8: Accept confirmation dialog
    HCMClient.dlgFDMConfiguration.btnYes.ClickButton();

    Log.Checkpoint("✅ Device successfully unlocked and configured with DTM.");

  } catch (error) {
    Log.Error("❌ Error in Device_Explicit_Lock: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      ELCON_History_readall15876
// Description:   Reads and saves device history using DD and DTM configuration paths.
// Created On:    06-Aug-2025
// =====================================================================
function ELCON_History_readall15876() {
  Log.AppendFolder("ELCON_History_readall15876");

  try {
    // 🔐 Launch FDM client
 //   launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    Log.Message("FDM Client launched.");

    // 🌐 Navigate to Online and Network View tabs
    ClickOnlineViewTab();
    clickOnNetworkViewTab();

    // 🌲 Access device tree
    let treeView = Aliases.HCMClient.ClientMainWindow.panelLeftPanMain
                    .tabControlLeftPanMain.tabPageOnlineView.panelOnlineView
                    .panelTabControlOnlineView.tabControlOnlineView.tabConnected.treeView;

    if (!treeView.Exists) {
      Log.Error("❌ TreeView not found.");
      return;
    }

    // 📌 Right-click device and configure with DD/Package
    let ItemPath = Project.Variables.Device;
    treeView.ClickItemR(ItemPath);
    treeView.StripPopupMenu.Click("Configure with|DD/Package");
    
    //Wait for Device load
    waitForStatusBarText("Device loaded successfully")
  
    // 💾 Save history using DD path
    clickSaveHistoryHyperlink();
    let input = Project.Variables.Device;
    let parts = input.split("|");
    let lastValue = parts[parts.length - 1];
    fillSaveHistoryPopup(lastValue + aqDateTime.Now() / 1000);
    handleFdmConfigurationPopup();
    handleSaveHistoryCompletion();
    CloseWindow();
    clickOnConfirmFDMButton();

    // 🔁 Repeat for DTM (Online) configuration
    treeView.ClickItemR(ItemPath);
    treeView.StripPopupMenu.Click("Configure with|DTM (Online)");

    let HCMClient = Aliases.HCMClient;
    let panel = HCMClient.ClientMainWindow.MdiClient.DtmForm.panelBase
                  .panelForDerivedForms.DTMTabView.panelConfiguration
                  .tabControl1.TabPage.panelDtmStartup;

    aqObject.CheckProperty(panel, "Exists", cmpEqual, true);
    panel.panel1.SaveAsHistoryLink.ClickLink(0);

    fillSaveHistoryPopup(lastValue + aqDateTime.Now() / 1000);
    handleFdmConfigurationPopup();

    // ❎ Final cleanup
    CloseWindow();
    clickOnConfirmFDMButton();

    Log.Message("History saved successfully using both DD and DTM paths.");

  } catch (error) {
    Log.Error("Error in ELCON_History_readall15876: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      History_Hart_DTM_DeviceMux15848
// Description:   Saves device history and verifies its presence in the history viewer.
// Created On:    12-Aug-2025
// Modified On:   12-Aug-2025
// =====================================================================

function History_Hart_DTM_DeviceMux15848() {
  Log.AppendFolder("History_Hart_DTM_DeviceMux15848");

  try {
    const filePath = Project.Path + "Stores\\Files\\TestData.json";
    const testCaseId = "History_Hart_DTM_DeviceMux15848";

    const testData = getTestCaseData(filePath, testCaseId);
    if (testData) {
        // === Step 1: Navigate to device view ===
        ClickOnlineViewTab();
        clickOnNetworkViewTab();
        clickOnDevice(testData.Device);

        // === Step 2: Save device history ===
        clickSaveHistoryHyperlink();

        let input = testData.Device;
        let parts = input.split("|");
        let lastValue = parts[parts.length - 1];
        let SaveName = lastValue + "_" + Math.floor(aqDateTime.Now() / 1000);  // Timestamp for uniqueness

        fillSaveHistoryPopup(SaveName);
        handleFdmConfigurationPopup();
        handleSaveHistoryCompletion();

        // === Step 3: Confirm and close dialogs ===
        CloseWindow();
        clickOnConfirmFDMButton();

        // === Step 4: Open history viewer for the device ===
        let frmHCMClientMain = Aliases.HCMClient.ClientMainWindow;
        let treeView = frmHCMClientMain.panelLeftPanMain.tabControlLeftPanMain.tabPageOnlineView
                        .panelOnlineView.panelTabControlOnlineView.tabControlOnlineView
                        .tabConnected.treeView;

        treeView.ClickItemR(testData.Device);
        treeView.StripPopupMenu.Click(testData.PopupMenu);

        // === Step 5: Select saved history entry and view ===
        let panel = frmHCMClientMain.MdiClient.HistoryFrom.panelBase.panelForDerivedForms;
        let adornerDecorator = panel.panel1.ElementHost.HwndSource_AdornerDecorator.AdornerDecorator;

        adornerDecorator.cmb_HistoryName.ClickItem(`*${SaveName}*`);
        adornerDecorator.btn_View.ClickButton();

        // === Step 6: Verify history screen loaded ===
        let historyScreen = panel.pnlHistoryConfig.MagicTabControlEx.TabPage.CDeviceScreen
                              .m_pnlDeviceScreen.TabControl.TabPage.ElementHost
                              .HwndSource_AdornerDecorator.AdornerDecorator.ScrollViewer;

        aqObject.CheckProperty(historyScreen, "Exists", cmpEqual, true);

        // === Step 7: Final cleanup ===
        CloseWindow();
    
    } else {
      Log.Warning("No test data found for TestCase ID: " + testCaseId);
    }

  } catch (error) {
    Log.Error("Error in History_Hart_DTM_DeviceMux15848: " + error.message);

  } finally {
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      LoadHARTDevice15796
// Description:   Loads HART device using DD/Package, DTM (Online), and DTM (Offline) configurations.
// Created On:    12-Aug-2025
// Modified On:   12-Aug-2025
// =====================================================================

function LoadHARTDevice15796() {
  Log.AppendFolder("LoadHARTDevice15796");

  try {
    // === Step 1: Navigate to Online View and Network View ===
    ClickOnlineViewTab();
    clickOnNetworkViewTab();

    let HCMClient = Aliases.HCMClient;
    let treeView = HCMClient.ClientMainWindow.panelLeftPanMain.tabControlLeftPanMain
                    .tabPageOnlineView.panelOnlineView.panelTabControlOnlineView
                    .tabControlOnlineView.tabConnected.treeView;

    // === Step 2: Configure with DD/Package ===
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("Configure with|DD/Package");

    aqObject.CheckProperty(
      NameMapping.Sys.HCMClient.ClientMainWindow.MdiClient.CDeviceHomePage.panelBase.panelForDerivedForms.Panel
        .MagicTabControlEx.EntryPointTabPage.CDeviceScreen.m_pnlDeviceScreen.TabControl.EntryPointsTabPage
        .ElementHost.HwndSource_AdornerDecorator.AdornerDecorator.ScrollViewer,
      "Enabled", cmpEqual, true
    );

    CloseWindow();
    clickOnConfirmFDMButton();

    // === Step 3: Configure with DTM (Online) ===
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("Configure with|DTM (Online)");

    let manualDtmSelector = HCMClient.ManualDtmSelector;
    aqObject.CheckProperty(manualDtmSelector, "Enabled", cmpEqual, true);

    let winButton = manualDtmSelector.panel1.btnCancel;
    OCR.Recognize(winButton).BlockByText("Cancel").Click();

    // === Step 4: Configure with DTM (Offline) ===
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("Configure with|DTM (Offline)");

    aqObject.CheckProperty(manualDtmSelector, "Enabled", cmpEqual, true);
    OCR.Recognize(winButton).BlockByText("Cancel").Click();

  } catch (error) {
    Log.Error("Error in LoadHARTDevice15796: " + error.message);

  } finally {
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      LogUserAction15798
// Description:   Automates the process of logging a user action in the Audit Trail,
//                dynamically generates a unique description using the device name and timestamp,
//                and verifies the entry in the Audit Trail grid.
// Created On:    12-Aug-2025
// Modified On:   12-Aug-2025
// =====================================================================
function LogUserAction15798() {
  Log.AppendFolder("LogUserAction15798");

  try {
    ClickOnlineViewTab();
    clickOnNetworkViewTab();
    
    let HCMClient = Aliases.HCMClient;
    let treeView = HCMClient.ClientMainWindow.panelLeftPanMain
                    .tabControlLeftPanMain.tabPageOnlineView.panelOnlineView
                    .panelTabControlOnlineView.tabControlOnlineView
                    .tabConnected.treeView;

    // 🌲 Right-click and log user action
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("Log User Action");
    
    let AuditDescription = "User able to enter the text in description field " + Math.floor(aqDateTime.Now() / 1000);

    // 📝 Fill in Description and Reason
    let auditTrailUserAction = HCMClient.AuditTrailUserAction;
    auditTrailUserAction.DescriptionTextBox.TextBoxArea.Keys(AuditDescription);

    let reasonBox = auditTrailUserAction.ReasonTextBox.TextBoxArea;
    reasonBox.Click(39, 32);
    reasonBox.Keys("Log User Action");

    // ✅ Confirm action
    OCR.Recognize(auditTrailUserAction.OKButton).BlockByText("OK").Click();

    // 🔍 View Audit Trail and verify entry
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("View Audit Trail");

    let isLogged = FindValueInDescriptionColumn(AuditDescription);
    Log.Message("Audit entry verification: " + isLogged);

    // 🧹 Cleanup
    CloseWindow();

  } catch (error) {
    Log.Error("Error in LogUserAction15798: " + error.message);

  } finally {
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      MuxConfig_MTL15961
// Description:   Configures MUX device, updates text field, and sends review.
// Created On:    13-Aug-2025
// =====================================================================
function MuxConfig_MTL15961() {
  Log.AppendFolder("MuxConfig_MTL15961");

  try {
    // 🌐 Navigate to Online View and build network
    ClickOnlineViewTab();
    clickOnNetworkViewTab();
    BuildNetwork();
    clickOnDevice(Project.Variables.Device);
    Log.Message("Device selected: " + Project.Variables.Device);

    let HCMClient = Aliases.HCMClient;
    let tabPage = HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage;

    // 🔍 Open FDM Device Properties
    tabPage.EntryPointsTabPage.HwndSource_AdornerDecorator.AdornerDecorator.HyperlinkFdmDeviceProperties.Click();
    Log.Message("FDM Device Properties opened.");

    let adornerDecorator = tabPage.FDM_Device_Properties.ElementHost.HwndSource_AdornerDecorator.AdornerDecorator;
    let scrollViewer = adornerDecorator.ScrollViewer;

    // 📝 Scroll to top and update text field
    scrollViewer.VScroll.Pos = 0;
    let textBox = scrollViewer.TextBox;
    textBox.Click(121, 16);
    let timestamp = Math.floor(aqDateTime.Now() / 1000);
    textBox.SetText(`No Data available ${timestamp}`);
    Log.Message("Text field updated with timestamp: " + timestamp);

    // 📤 Submit review
    adornerDecorator.ButtonReviewSend.ClickButton();
    let previewDialog = HCMClient.HwndSource_PreviewDialog.PreviewDialog;
    previewDialog.btn_Send.ClickButton();
    previewDialog.Rectangle.Click(6, 14);
    Log.Message("Review submitted.");

    // ❎ Close window and confirm
    CloseWindow();
    clickOnConfirmFDMButton();
    Log.Message("Window closed and confirmation clicked.");

  } catch (error) {
    Log.Error("Error in MuxConfig_MTL15961: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      muxconfig_pnf15962
// Description:   Configures MUX device, updates text field, and sends review.
// Created On:    13-Aug-2025
// =====================================================================
function muxconfig_pnf15962() {
  Log.AppendFolder("muxconfig_pnf15962");

  try {
    // 🌐 Navigate to Online View and build network
    ClickOnlineViewTab();
    clickOnNetworkViewTab();
    BuildNetwork();
    clickOnDevice(Project.Variables.Device);
    Log.Message("Device selected: " + Project.Variables.Device);

    let HCMClient = Aliases.HCMClient;
    let tabPage = HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage;

    // 🔍 Open FDM Device Properties
    tabPage.EntryPointsTabPage.HwndSource_AdornerDecorator.AdornerDecorator.HyperlinkFdmDeviceProperties.Click();
    Log.Message("FDM Device Properties opened.");

    let adornerDecorator = tabPage.FDM_Device_Properties.ElementHost.HwndSource_AdornerDecorator.AdornerDecorator;
    let scrollViewer = adornerDecorator.ScrollViewer;

    // 📝 Scroll to top and update text field
    scrollViewer.VScroll.Pos = 0;
    let textBox = scrollViewer.TextBox;
    textBox.Click(121, 16);
    let timestamp = Math.floor(aqDateTime.Now() / 1000);
    textBox.SetText(`No Data available ${timestamp}`);
    Log.Message("Text field updated with timestamp: " + timestamp);

    // 📤 Submit review
    adornerDecorator.ButtonReviewSend.ClickButton();
    let previewDialog = HCMClient.HwndSource_PreviewDialog.PreviewDialog;
    previewDialog.btn_Send.ClickButton();
    previewDialog.Rectangle.Click(6, 14);
    Log.Message("Review submitted.");

    // ❎ Close window and confirm
    CloseWindow();
    clickOnConfirmFDMButton();
    Log.Message("Window closed and confirmation clicked.");

  } catch (error) {
    Log.Error("Error in muxconfig_pnf15962 " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      muxconfig_stahl15963
// Description:   Configures MUX device, updates text field, and sends review.
// Created On:    13-Aug-2025
// =====================================================================
function muxconfig_stahl15963() {
  Log.AppendFolder("muxconfig_stahl15963");

  try {
    // 🌐 Navigate to Online View and build network
    ClickOnlineViewTab();
    clickOnNetworkViewTab();
    BuildNetwork();
    clickOnDevice(Project.Variables.Device);
    Log.Message("Device selected: " + Project.Variables.Device);

    let HCMClient = Aliases.HCMClient;
    let tabPage = HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage;

    // 🔍 Open FDM Device Properties
    tabPage.EntryPointsTabPage.HwndSource_AdornerDecorator.AdornerDecorator.HyperlinkFdmDeviceProperties.Click();
    Log.Message("FDM Device Properties opened.");

    let adornerDecorator = tabPage.FDM_Device_Properties.ElementHost.HwndSource_AdornerDecorator.AdornerDecorator;
    let scrollViewer = adornerDecorator.ScrollViewer;

    // 📝 Scroll to top and update text field
    scrollViewer.VScroll.Pos = 0;
    let textBox = scrollViewer.TextBox;
    textBox.Click(121, 16);
    let timestamp = Math.floor(aqDateTime.Now() / 1000);
    textBox.SetText(`No Data available ${timestamp}`);
    Log.Message("Text field updated with timestamp: " + timestamp);

    // 📤 Submit review
    adornerDecorator.ButtonReviewSend.ClickButton();
    let previewDialog = HCMClient.HwndSource_PreviewDialog.PreviewDialog;
    previewDialog.btn_Send.ClickButton();
    previewDialog.Rectangle.Click(6, 14);
    Log.Message("Review submitted.");

    // ❎ Close window and confirm
    CloseWindow();
    clickOnConfirmFDMButton();
    Log.Message("Window closed and confirmation clicked.");

  } catch (error) {
    Log.Error("Error in muxconfig_stahl15963 " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      OfflineConfig_HARTDDdevice_EPKSNW15785
// Description:   Creates and overwrites HART DD offline configuration template from history.
// Created On:    14-Aug-2025
// =====================================================================
function OfflineConfig_HARTDDdevice_EPKSNW15785() {
  Log.AppendFolder("OfflineConfig_HARTDDdevice_EPKSNW15785");

  try {
    const filePath = Project.Path + "Stores\\Files\\TestData.json";
    const testCaseId = "OfflineConfig_HARTDDdevice_EPKSNW15785";

    const testData = getTestCaseData(filePath, testCaseId);
    if (testData) {
      
      ClickOnlineViewTab();
      clickOnNetworkViewTab();

      let HCMClient = Aliases.HCMClient;
      let frmHCMClientMain = HCMClient.ClientMainWindow;
      let treeView = frmHCMClientMain.panelLeftPanMain
                      .tabControlLeftPanMain.tabPageOnlineView.panelOnlineView
                      .panelTabControlOnlineView.tabControlOnlineView.tabConnected.treeView;

      // 📂 Initiate template creation from history
      treeView.ClickItemR(testData.Device);
      treeView.StripPopupMenu.Click(testData.HistoryTemplate);

      let historyFileList = HCMClient.HistoryFileList;
      let listView = historyFileList.listView1;
      listView.ClickItem("6441754471472", 0);
      historyFileList.btnOK.ClickButton();

      // 📝 Enter filename and save
      let hostPanel = frmHCMClientMain.MdiClient.CreateConfigHistForm.panelBase;
      let adornerDecorator = hostPanel.panelForDerivedForms.panel1.ElementHost.HwndSource_AdornerDecorator.AdornerDecorator;
      let textBox = adornerDecorator.txt_fileName;

      let timestamp = aqConvert.DateTimeToFormatStr(aqDateTime.Now(), "%Y%m%d%H%M%S");
      let saveFileName = "Barath_" + timestamp;
      textBox.SetText(saveFileName);
      adornerDecorator.ButtonSave.ClickButton();

      // ✅ Confirm success
      let dlgSuccess = HCMClient.dlgFDMConfiguration;
      // aqObject.CheckProperty(dlgSuccess.Static, "WndCaption", cmpEqual, "Offline configuration saved successfully");
      dlgSuccess.btnOK.ClickButton();
      hostPanel.panelFullTop.panelTitle.buttonClose.Click(10, 7);
      dlgSuccess.btnYes.ClickButton();

      // 🔁 Attempt overwrite with same name
      treeView.ClickItemR(Project.Variables.Device);
      treeView.StripPopupMenu.Click(testData.HistoryTemplate);
      listView.ClickItem("6441754471472", 0);
      historyFileList.btnOK.ClickButton();

      textBox.Drag(174, 11, -269, 8); // Optional: clear or reposition
      textBox.SetText(saveFileName);
      adornerDecorator.ButtonSave.ClickButton();

      // aqObject.CheckProperty(dlgSuccess.Static, "WndCaption", cmpEqual, `Offline Template Name ${saveFileName} already exists`);
      dlgSuccess.btnOK.ClickButton();
      hostPanel.panelFullTop.panelTitle.buttonClose.Click(9, 18);
      dlgSuccess.btnYes.ClickButton();

      Log.Message("Offline configuration created and overwrite handled for: " + saveFileName);
    } else {
      Log.Warning("No test data found for TestCase ID: " + testCaseId);
    }
  } catch (error) {
    Log.Error("Error in OfflineConfig_HARTDDdevice_EPKSNW15785: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      OfflineDownload_HARTDD15849
// Description:   Downloads offline configuration for HART DD device and validates success.
// Created On:    19-Aug-2025
// =====================================================================
function OfflineDownload_HARTDD15849() {
  Log.AppendFolder("OfflineDownload_HARTDD15849");

  try {
    const filePath = Project.Path + "Stores\\Files\\TestData.json";
    const testCaseId = "OfflineDownload_HARTDD15849";

    const testData = getTestCaseData(filePath, testCaseId);
    if (testData) {
        let HCMClient = Aliases.HCMClient;
        let frmHCMClientMain = HCMClient.ClientMainWindow;

        // 🌲 Right-click device and trigger download
        let treeView = frmHCMClientMain.panelLeftPanMain
                        .tabControlLeftPanMain.tabPageOnlineView.panelOnlineView
                        .panelTabControlOnlineView.tabControlOnlineView.tabConnected.treeView;

        treeView.ClickItemR(Project.Variables.Device);
        treeView.StripPopupMenu.Click("Offline Configuration|Download Offline Configuration");
        Log.Message("Download Offline Configuration triggered for: " + Project.Variables.Device);

        // 📂 Access download panel
        let hostPanel = frmHCMClientMain.MdiClient.HCMOfflineConfigForm.panelBase;
        let panel = hostPanel.panelForDerivedForms.panelOfflineBase;

        aqObject.CheckProperty(panel, "Enabled", cmpEqual, true);
        Log.Message("Offline configuration panel is enabled.");

        // 📁 Select configuration
        panel.pnlDownloadConfiguration.ElementHost.HwndSource_AdornerDecorator.AdornerDecorator.ButtonSelect.ClickButton();
        Log.Message("Configuration selection initiated.");

        // ⬇️ Download parameters
        let adornerDecorator = panel.groupBoxConfigView.pnlConfiguration.OfflineDownloadConfig
                                    .HwndSource_AdornerDecorator.AdornerDecorator;

        adornerDecorator.btn_Download.ClickButton();
        Log.Message("Download button clicked.");

        // ✅ Wait for success message
        adornerDecorator.TextblockParametersDownloadedSucc.WaitProperty("Exists", true, 100000);
        aqObject.CheckProperty(adornerDecorator.TextblockParametersDownloadedSucc, "WPFControlText", cmpContains, "parameters downloaded successfully");
        Log.Message("Parameters downloaded successfully.");

        // ❎ Close configuration window
        hostPanel.panelFullTop.panelTitle.buttonClose.Click(19, 11);
        Log.Message("Offline configuration window closed.");
    } else {
      Log.Warning("No test data found for TestCase ID: " + testCaseId);
    }
  } catch (error) {
    Log.Error("Error in OfflineDownload_HARTDD15849: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      OnlineMuxdevices15797
// Description:   Renames a MUX device node in the tree view, handles name conflict,
//                and retries renaming from an alternate node path.
// Created On:    19-Aug-2025
// Modified On:   19-Aug-2025
// =====================================================================

function OnlineMuxdevices15797() {
  Log.AppendFolder("OnlineMuxdevices15797");

  try {
    BuildNetwork()
    let HCMClient = Aliases.HCMClient;
    let treeView = HCMClient.ClientMainWindow.panelLeftPanMain
                    .tabControlLeftPanMain.tabPageOnlineView.panelOnlineView
                    .panelTabControlOnlineView.tabControlOnlineView.tabConnected.treeView;

    // === Step 1: Attempt to rename device to '644Temperature' ===
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("Rename");

    let renameNodeDialog = HCMClient.HwndSource_RenameNodeDialog.RenameNodeDialog;
    let textBox = renameNodeDialog.NewNameTextBox;
    textBox.Keys("![ReleaseLast]");  // Clear previous name
    textBox.SetText("644Temperature");

    let button = renameNodeDialog.ButtonConfirm;
    button.ClickButton();

    // === Step 2: Attempt to rename again to '644FDMdevice' ===
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("Rename");
    textBox.SetText("644FDMdevice");
    button.ClickButton();

    // === Step 3: Handle name conflict warning ===
    let textBlock = renameNodeDialog.WarningMessageTextBlock;
    aqObject.CheckProperty(textBlock, "Enabled", cmpEqual, true);
    aqObject.CheckProperty(textBlock, "WPFControlText", cmpEqual, "⚠ Name Already Exists");
    renameNodeDialog.ButtonCancel.ClickButton();

    // === Step 4: Retry renaming from alternate node path ===
    treeView.ClickItemR("|FDM Server ( DESKTOP-AJ7O5O5 )|DESKTOP-AJ7O5O5|MUX|SFT_PNF|644Temperature");
    treeView.StripPopupMenu.Click("Rename");
    textBox.SetText("644FDMdevice");
    button.ClickButton();

  } catch (error) {
    Log.Error("Error in OnlineMuxdevices15797: " + error.message);

  } finally {
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      OptionsFunction15817
// Description:   Opens device options, selects a specific DTM package,
//                and configures the device with DTM (Online).
// Created On:    20-Aug-2025
// Modified On:   20-Aug-2025
// =====================================================================

function OptionsFunction15817() {
  Log.AppendFolder("OptionsFunction15817");

  try {
    // === Step 1: Build network before accessing device options ===
    //BuildNetwork();

    let HCMClient = Aliases.HCMClient;
    let treeView = HCMClient.ClientMainWindow.panelLeftPanMain
                    .tabControlLeftPanMain.tabPageOnlineView.panelOnlineView
                    .panelTabControlOnlineView.tabControlOnlineView.tabConnected.treeView;

    // === Step 2: Open device options dialog ===
    treeView.ClickItemR(Project.Variables.Device);
    treeView.StripPopupMenu.Click("Options");

    let deviceOptionsDlg = HCMClient.DeviceOptionsDlg;

    // === Step 3: Open DTM Info link ===
    deviceOptionsDlg.groupBox2.linkLabel_DTMInfo.ClickLink(0);

    let manualDtm_PackageSelector = HCMClient.ManualDtm_PackageSelector;
    aqObject.CheckProperty(manualDtm_PackageSelector, "Enabled", cmpEqual, true);

    // === Step 4: Select DTM package ===
    let tabControl = manualDtm_PackageSelector.tabControl1;
    tabControl.ClickTab("DTM Selection Dialog");
    tabControl.tabPage1.ManualDtmSelectorPanel.groupBox1.lvwDtmList.ClickItem("644 V07.01 *", 0);

    OCR.Recognize(manualDtm_PackageSelector.btnOk).BlockByText("OK").Click();

    // === Step 5: Confirm device options ===
    deviceOptionsDlg.btnOK.Click(31, 17);

    // === Step 6: Configure device with DTM (Online) ===
    let frmHCMClientMain = HCMClient.ClientMainWindow;
    treeView = frmHCMClientMain.panelLeftPanMain.tabControlLeftPanMain
               .tabPageOnlineView.panelOnlineView.panelTabControlOnlineView
               .tabControlOnlineView.tabConnected.treeView;

    treeView.ClickItemR("|FDM Server ( DESKTOP-AJ7O5O5 )|DESKTOP-AJ7O5O5|MUX|SFT_PNF|644Temperature");
    treeView.StripPopupMenu.Click("Configure with|DTM (Online)");

    aqObject.CheckProperty(
      frmHCMClientMain.MdiClient.DtmForm.panelBase.panelForDerivedForms.DTMTabView
        .panelConfiguration.tabControl1.TabPage.panelDtmStartup,
      "Enabled", cmpEqual, true
    );

    // === Step 7: Final cleanup ===
    CloseWindow();
    clickOnConfirmFDMButton();

  } catch (error) {
    Log.Error("Error in OptionsFunction15817: " + error.message);

  } finally {
    Log.PopLogFolder();
  }
}

//USEUNIT DrFDMPages

// =====================================================================
// Author:        Bharath
// Function:      startDRFDM
// Description:   Starts DR FDM services, executes workflow, and terminates app.
// Created On:    30-Jul-2025
// Modified On:   30-Jul-2025
// =====================================================================

function startServicesDRFDM() {
  Log.AppendFolder("startDRFDM - Full DR FDM Cycle");

  let status = "Pass";

  try {
    // Step 1: Start services and workflow
    startServices();
    Log.Message("Services started and workflow triggered.");

    // Step 2: Terminate DR FDM
    terminateDRFDM();
    Log.Message("DR FDM terminated successfully.");

  } catch (error) {
    Log.Error("Error in startDRFDM: " + error.message);
    status = "Fail";
  } finally {
    WriteResult("startServicesDRFDM " + status, status, "Pass");
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      stopDRFDM
// Description:   stops DR FDM services, executes workflow, and terminates app.
// Created On:    30-Jul-2025
// Modified On:   30-Jul-2025
// =====================================================================

function stopServicesDRFDM() {
  Log.AppendFolder("stopDRFDM - Full DR FDM Cycle");

  let status = "Pass";

  try {
    // Step 1: Stop services and workflow
    stopServices();
    Log.Message("Services stopped and workflow triggered.");

    // Step 2: Terminate DR FDM
    terminateDRFDM();
    Log.Message("DR FDM terminated successfully.");

  } catch (error) {
    Log.Error("Error in stopDRFDM: " + error.message);
    status = "Fail";
  } finally {
    WriteResult("stopServicesDRFDM " + status, status, "Pass");
    Log.PopLogFolder();
  }
}

function collectLogsFromDrFDM() {
  Log.AppendFolder("collectLogsFromDrFDM");

  let status = "Pass";

  try {
    checkCollectAndProceedToFinalForm();
    Log.Message("Log collection from DR FDM completed.");
  } catch (error) {
    Log.Error("Error during log collection from DR FDM: " + error.message);
    status = "Fail";
  }

  WriteResult("collectLogsFromDrFDM " + status, status, "Pass");
  Log.PopLogFolder();
}



function clickNetworkTab() {
  Log.AppendFolder("clickNetworkTab");

  let status = "Pass";

  try {
    clickOnNetworkViewTab()

  } catch (error) {
    Log.Error("Error in clickNetworkTab: " + error.message);
    status = "Fail";
  }

  WriteResult("clickNetworkTab " + status, status, "Pass");
  Log.PopLogFolder();
}

function ClickOnlineView() {
  Log.AppendFolder("ClickOnlineView");

  let status = "Pass";

  try {
    ClickOnlineViewTab()

  } catch (error) {
    Log.Error("Error in ClickOnlineView " + error.message);
    status = "Fail";
  }

  WriteResult("ClickOnlineView " + status, status, "Pass");
  Log.PopLogFolder();
}

//USEUNIT LibraryPages

// =====================================================================
// Author:        Bharath
// Function:      FDMGR4779()
// Description:   Test case to validate add DD User interfacee
// Created On:    23-June-2025
// Modified On:   
// =====================================================================
function FDMGR4779() {
  try {
    Log.AppendFolder("FDMGR4779 - Test case to validate add DD User interface")
    // Launch the FDM Client with credentials
    //launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);

    // Navigate and perform DD Package addition
    openManageDDPackagesSection();
    clickAddDDPackageButton();
    selectDDFileTypeFromDropdown("*.fm8");
    uploadDDPackageFile(Project.Path + "Stores\\Files", "0906");
    clickAddToLibraryButton();

    // Close relevant popups and exit
    clickAdd_DDPackagePopUpCloseButton();
    clickManage_DDPackagePopUpCloseButton();

    // Terminate the client gracefully
  //  TestedApps.HCMClient.Terminate();

    Log.Message("Test 'addDDPackageAndExit' completed successfully.");
  } catch (error) {
    Log.Error("Test 'addDDPackageAndExit' failed: " + error.message);
    // Optional: Consider taking a screenshot here
  } finally{
    Log.PopLogFolder()
  }
}


// =====================================================================
// Author:        Bharath
// Function:      FDMGR4798
// Description:   Testcase to validate generic DD/package functionality
// Created On:    23-June-2025
// Modified On:   
// =====================================================================
function FDMGR4798() {
  try {
    Log.AppendFolder("FDMGR4798 - Testcase to validate generic DD/package functionality")
   // launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    openManageDDPackagesSection();
    selectProtocol("HART")
    selectManufacturer("Rosemount (26)");
    selectDeviceType("3051 (2606)");
    findDDAndClickDeleteRow("3051 (2606)","9","6")
    clickManage_DDPackagePopUpCloseButton();
    //TestedApps.HCMClient.Terminate();
    Log.Message("Test 'deleteSpecificDDPackageAndExit' executed successfully.");
  } catch (error) {
    Log.Error("Test 'deleteSpecificDDPackageAndExit' failed: " + error.message);
  } finally{
    Log.PopLogFolder()
  }
}

// =====================================================================
// Author:        Bharath
// Function:      FDMGR4723()
// Description:   Test case to validate add FDIX file User interfacee
// Created On:    23-June-2025
// Modified On:   
// =====================================================================
function FDMGR4723() {
  try {
    Log.AppendFolder("FDMGR4723 - Test case to validate add FDIX file User interfacee")
    // Launch the FDM Client with credentials
  //  launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);

    // Navigate and perform DD Package addition
    openManageDDPackagesSection();
    clickAddDDPackageButton();
    selectDDFileTypeFromDropdown("*.fdix");
    uploadDDPackageFile(Project.Path + "Stores\\Files", "abb.tzidc.02.02.00.hart");
    clickAddToLibraryButton();

    // Close relevant popups and exit
    clickAdd_DDPackagePopUpCloseButton();
    clickManage_DDPackagePopUpCloseButton();

    // Terminate the client gracefully
   // TestedApps.HCMClient.Terminate();

    Log.Message("Test 'addFDIXPackageAndExit' completed successfully.");
  } catch (error) {
    Log.Error("Test 'addFDIXPackageAndExit' failed: " + error.message);
    // Optional: Consider taking a screenshot here
  } finally{
    Log.PopLogFolder()
  }
}


// =====================================================================
// Author:        Bharath
// Function:      FDMGR4790
// Description:   Testcase to validate generic FDI/package functionality
// Created On:    23-June-2025
// Modified On:   
// =====================================================================
function FDMGR4790() {
  try {
    Log.AppendFolder("FDMGR4790 - Testcase to validate generic FDI/package functionality")
  //  launchFDMClient(Project.Variables.FDMClientUserName, Project.Variables.FDMClientPassword);
    openManageDDPackagesSection();
    selectProtocol("HART")
    selectManufacturer("ABB - Hartmann & Braun (16)");
    selectDeviceType("TZIDC (1641)");
    findDDAndClickDeleteRow("TZIDC (1641)","2","1")
    clickManage_DDPackagePopUpCloseButton();
   // TestedApps.HCMClient.Terminate();
    Log.Message("Test 'deleteSpecificFDIPackageAndExit' executed successfully.");
  } catch (error) {
    Log.Error("Test 'deleteSpecificFDIPackageAndExit' failed: " + error.message);
  } finally{
    Log.PopLogFolder()
  }
}




function AddDD(filePath, fileType) {
  Log.AppendFolder("AddDD - Validate DD Package Addition UI");

  let status = "Pass";

  try {
    // Navigate and perform DD Package addition
    openManageDDPackagesSection();
    clickAddDDPackageButton();
    selectDDFileTypeFromDropdown(fileType);
    uploadDDPackageFile(Project.Path, filePath);
    clickAddToLibraryButton();

    // Close relevant popups and exit
    clickAdd_DDPackagePopUpCloseButton();
    clickManage_DDPackagePopUpCloseButton();

    Log.Message("DD package added and exited successfully.");
    
  } catch (error) {
    Log.Error("AddDD failed: " + error.message);
    status = "Fail";
  } finally {
    WriteResult("AddDD " + status, status, "Pass");
    Log.PopLogFolder();
  }
}

// =====================================================================
// Author:        Bharath
// Function:      DeleteDD
// Description:   Deletes a DD package for the device  under HART protocol
//                by navigating the DD management section, selecting filters, deleting the entry,
//                and terminating the client application.

// =====================================================================

function DeleteDD(Protocol, Manufacturer, DeviceType, targetdeviceRevision, targetDDpackageVersion) {
  Log.AppendFolder("DeleteDD - Device Description Package Deletion");

  let status = "Pass";

  try {
    // Navigate to DD package section
    openManageDDPackagesSection();
    Log.Message("Opened Manage DD Packages section.");

    // Select filters for deletion
    selectProtocol(Protocol);
    Log.Message("Protocol selected: " + Protocol);

    selectManufacturer(Manufacturer);
    Log.Message("Manufacturer selected: " + Manufacturer);

    selectDeviceType(DeviceType);
    Log.Message("Device type selected: " + DeviceType);

    // Delete the target DD package using revision numbers
    findDDAndClickDeleteRow(DeviceType, targetdeviceRevision, targetDDpackageVersion);
    Log.Message("Requested DD deletion for " + DeviceType + ", Rev " + targetdeviceRevision + "." + targetDDpackageVersion);

    // Close DD Package popup
    clickManage_DDPackagePopUpCloseButton();
    Log.Message("Closed DD Package popup.");

  } catch (error) {
    Log.Error("Exception in DeleteDD: " + error.message);
    status = "Fail";
  } finally {
    WriteResult("DeleteDD " + status, status, "Pass");
    Log.PopLogFolder();
  }
}




// =====================================================================
// Author:        Bharath
// Function:      UpdateDTMLibrary
// Description:   Navigates through the Library menu, updates DTM Library,
//                handles confirmation dialogs, and exits gracefully.
// Created On:    31-Jul-2025
// Modified On:   31-Jul-2025
// =====================================================================

function UpdateDTMLibrary() {
  let HCMClient = Aliases.HCMClient;
  Log.AppendFolder("navigateAndUpdateDTMLibrary");

  try {
    // Step 1: Click on 'Library' menu
    OCR.Recognize(HCMClient.ClientMainWindow.mainMenu).BlockByText("Library").Click();
    Log.Message("Clicked 'Library' menu");

    // Step 2: Select 'Manage DTM Library'
    OCR.Recognize(HCMClient.DropDownForm.SubSmartControl).BlockByText("Manage DTM Library").Click();
    Log.Message("Selected 'Manage DTM Library'");

    let manageDtmLibrary = HCMClient.ManageDtmLibrary;

    // Step 3: Click 'Update' button
    manageDtmLibrary.btnUpdate.Click();
    Log.Message("Clicked 'Update' button");

    // Step 4 & 5: Confirm dialog twice
    clickOnConfirmFDMButton();
    clickOnConfirmFDMButton();

    // Step 6: Cancel the dialog
    manageDtmLibrary.CancelBtn.Click();
    Log.Message("Clicked 'Cancel' button");
    
    manageDtmLibrary.CancelBtn.WaitProperty("Enabled",true,25000)
    manageDtmLibrary.CancelBtn.Click();
    
    // Step 7: Final confirm dialog
    clickOnConfirmFDMButton();

    Log.Checkpoint("DTM Library update workflow completed successfully.");

  } catch (error) {
    Log.Error("Error in navigateAndUpdateDTMLibrary: " + error.message);

  } finally {
    Log.PopLogFolder();
  }
 

}

//USEUNIT AttachDetachPages

// =====================================================================
// Author:        Bharath
// Function:      AttachDetachApp
// Description:   Automates attaching an application package and then detaching it
// =====================================================================

function AttachDetachApp() {
  try {
    Log.AppendFolder("AttachDetachApp - Attach and Detach Application Package");

    // Step 1: Click on the "Attach Application" button
    clickOnAttachApplication();

    // Step 2: Upload the application package file
    const packagePath = "C:\\Program Files (x86)\\Honeywell\\FDM\\ClientMachine\\Bin";
    const packageName = "HCMClient";
    uploadAppAttachPackageFile(packagePath, packageName);

    // Step 3: Detach the application
    DetachApplication();

    Log.Checkpoint("✅ AttachDetachApp passed: Application attached and detached successfully.");
  } catch (error) {
    Log.Error("❌ AttachDetachApp failed during attach/detach process:", error.message);
  } finally {
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      AttachDetachSystemDocument
// Description:   Automates the process of attaching and detaching a system-level
//                document via menu navigation, file upload, and confirmation steps.
// Created On:    21-Jul-2025
// Modified On:   21-Jul-2025
// =====================================================================

function AttachDetachSystemDocument15805() {
  Log.AppendFolder("AttachDetachSystemDocument - System-Level Document Flow");

  try {
    // Step 1: Navigate via menu and select system document
    clickOnSystemAttachDocument()
    Log.Message("Navigated to system document attachment workflow.");

    // Step 2: Upload document
    uploadPackageFile(Project.Path + "Stores\\Files", "0906.fm8");
    Log.Message("Uploaded system document: 0906.fm8");

    // Step 3: Confirm attachment
    clickOnConfirmFDMButton();
    Log.Message("Confirmed attachment in FDM dialog.");
    
    // Step 4: Detach system document
    DetachSystemDocument();
    Log.Message("Initiated detachment of system document.");

  } catch (error) {
    Log.Error("Exception occurred in AttachDetachSystemDocument: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      AttachDetachDeviceDocumentation15782
// Description:   Attaches a document to a device via context menu flow,
//                confirms the action, then initiates detachment and confirms.
// Created On:    21-Jul-2025
// Modified On:   21-Jul-2025
// =====================================================================

function AttachDetachDeviceDocumentation15782() {
  Log.AppendFolder("AttachDetachDeviceDocumentation - Document Attach/Detach Flow");

  try {
    // Step 1: Attach document
    clickOnDeviceAttachDocument();

    // Step 2: Upload package file
    uploadPackageFile(Project.Path + "Stores\\Files", "0906.sym");
    Log.Message("Uploaded document: 0906.sym");

    // Step 3: Confirm attachment
    clickOnConfirmFDMButton();
    Log.Message("Confirmed attachment in FDM dialog.");

    // Step 4: Detach document
    clickOnDeviceDetachDocument();

    // Step 5: Handle resource dialog for detachment.
    Delay(1000)
    DetachDocumentFromResourceDlg();

    // Step 6: Confirm detachment
    clickOnConfirmFDMButton();
    Log.Message("Confirmed detachment in FDM dialog.");

  } catch (e) {
    Log.Error("Exception occurred during attach/detach process: " + e.message);
  } finally {
    Log.PopLogFolder();
  } 
}



function FDMGR4876(){
  Log.AppendFolder("FDMGR4876 - Save History")
  try{
  ClickOnlineViewTab()
  clickOnNetworkViewTab()
  input = Project.Variables.Device
  clickOnbuildNetwork(input.split("|").slice(0, -2).join("|"));
  clickOnbuildNetwork(input.split("|").slice(0, -1).join("|"));
  clickOnDevice(Project.Variables.Device);
  clickSaveHistoryHyperlink()
  input = Project.Variables.Device
  let parts = input.split("|");
  let lastValue = parts[parts.length - 1];
  fillSaveHistoryPopup(lastValue + aqDateTime.Now()/1000)
  handleFdmConfigurationPopup()
  handleSaveHistoryCompletion()
  CloseWindow()
  clickOnConfirmFDMButton()
  }
  
  catch(error){
    Log.Error("FDMGR4876 :- " + error.message )
  }
  finally{
    Log.PopLogFolder()
  }
  
}

function ActivateDevice(Device) {
  Log.AppendFolder("ActivateDevice");

  let status = "Pass";

  try {
    clickOnDevice(Device);
    Log.Message("Clicked on device: " + Device);
  } catch (error) {
    Log.Error("Error in EnterIntoDevice: " + error.message);
    status = "Fail";
  }

  WriteResult("ActivateDevice " + status, status, "Pass");
  Log.PopLogFolder();
}

function SaveHistory() {
  Log.AppendFolder("SaveHistory");

  let status = "Pass";

  try {
    clickSaveHistoryHyperlink();
    saveName = "SaveHistory" + aqDateTime.Now() / 1000
    fillSaveHistoryPopup("SaveHistory" + aqDateTime.Now() / 1000);
    handleFdmConfigurationPopup();
    handleSaveHistoryCompletion();
    CloseWindow();
    clickOnConfirmFDMButton();
    Log.Message("SaveHistory flow completed successfully.");
  } catch (error) {
    Log.Error("SaveHistory failed: " + error.message);
    status = "Fail";
  } finally {
    WriteResult("Save history Id:-"+saveName+" SaveHistory " + status, status, "Pass");
    Log.PopLogFolder();
  }
}


// =====================================================================
// Author:        Bharath
// Function:      DeviceParam
// Description:   Validates existence and text of various WPF hyperlinks 
//                under a selected device context.
// Created On:    23-Jul-2025
// Modified On:   23-Jul-2025
// =====================================================================

function DeviceParam() {
  Log.AppendFolder("DeviceParam - Validate Device Hyperlink Controls");

  try {
    // 🖱️ Click on the specified device
    clickOnDevice(Project.Variables.Device);
    Log.Message("Clicked on device: " + Project.Variables.Device);
    Delay(1000)
    let adornerDecorator = Aliases.HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage.EntryPointsTabPage.HwndSource_AdornerDecorator.AdornerDecorator;
    aqObject.CheckProperty(adornerDecorator.HyperlinkFdmDeviceStatus, "WPFControlText", cmpEqual, "FDM Device Status");
    aqObject.CheckProperty(adornerDecorator.HyperlinkFdmDeviceProperties, "WPFControlText", cmpEqual, "FDM Device properties");
    aqObject.CheckProperty(adornerDecorator.HyperlinkMethodList, "WPFControlText", cmpEqual, "Method List");
    aqObject.CheckProperty(adornerDecorator.HyperlinkSaveHistoryRecord, "WPFControlText", cmpEqual, "Save History Record");
    aqObject.CheckProperty(adornerDecorator.HyperlinkSaveAsOfflineTemplate, "WPFControlText", cmpEqual, "Save as Offline Template");
    aqObject.CheckProperty(adornerDecorator.HyperlinkExport, "WPFControlText", cmpEqual, "Export");
    aqObject.CheckProperty(adornerDecorator.HyperlinkPrint, "WPFControlText", cmpEqual, "Print");
    aqObject.CheckProperty(adornerDecorator.HyperlinkNotifications, "WPFControlText", cmpEqual, "Notifications");
    CloseWindow()
    clickOnConfirmFDMButton()

  } catch (error) {
    Log.Error("Exception in DeviceParam: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
  
}

// =====================================================================
// Author:        Bharath
// Function:      DeviceStateView
// Description:   Clicks on specified device, waits for load, and retrieves its state info.
// Created On:    31-Jul-2025
// Modified On:   31-Jul-2025
// =====================================================================

function DeviceStateView() {
  Log.AppendFolder("test - Device Selection and State Capture");

  try {
    // Step 1: Select device from variable
    clickOnDevice(Project.Variables.Device);
    Log.Message("Clicked on device: " + Project.Variables.Device);

    // Step 2: Delay to allow device to load
    Delay(1000, "Waiting for device UI to load");

    // Step 3: Collect and log device state information
    DeviceStateInformation();
    Log.Message("Device state information retrieved.");
    
    CloseWindow()
    clickOnConfirmFDMButton()
  } catch (error) {
    Log.Error("Error in test function: " + error.message);
  } finally {
    Log.PopLogFolder();
  }
}



function Print15728(){
  Log.AppendFolder("Print15728 - Print")
  try{
  BuildNetwork()
  clickOnDevice(Project.Variables.Device);
  let HCMClient = Aliases.HCMClient;
  HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage.EntryPointsTabPage.HwndSource_AdornerDecorator.AdornerDecorator.HyperlinkPrint.Click(13, 10);
  waitForStatusBarText("Loading online device data for print is performed successfully...")
  let printPreview = HCMClient.PrintPreview;
  aqObject.CheckProperty(printPreview, "Enabled", cmpEqual, true);
  let panel = printPreview.ButtonsPanel;
  OCR.Recognize(panel.PrintButton).BlockByText("Print").Click();
  HCMClient.dlgFDMConfiguration.Close();
  OCR.Recognize(panel.CloseButton).BlockByText("Close").Click();
  closeWindowPage()
  clickOnConfirmFDMButton()
  }
  
  catch(error){
    Log.Error("Print15728 :- " + error.message )
  }
  finally{
    Log.PopLogFolder()
  }
  

 
}


// =====================================================================
// Author:        Bharath
// Function:      SettingDeviceProperties15794
// Description:   Opens FDM device properties and configures usage, calibration status, and health.
// Created On:    21-Aug-2025
// Modified On:   21-Aug-2025
// =====================================================================

function SettingDeviceProperties15794() {
  Log.AppendFolder("SettingDeviceProperties15794");

  try {
    // === Step 1: Build network and select target device ===
    BuildNetwork();
    clickOnDevice(Project.Variables.Device);

    // === Step 2: Open device properties via OCR hyperlink ===
    OCR.Recognize(
      Aliases.HCMClient.ClientMainWindow.MdiClient.EntryPointTabPage.EntryPointsTabPage
        .HwndSource_AdornerDecorator.AdornerDecorator.HyperlinkFdmDeviceProperties
    ).BlockByText("Device").Click();

    // === Step 3: Configure device properties ===
    ReadAndConfigureDeviceProperties({
      DeviceUsage: "Spare",
      Calibrationstatus: "Calibrated",
      DeviceHealth: "Good"
    });
    
    CloseWindow()
    clickOnConfirmFDMButton()
    Log.Message("Device properties configured successfully.");

  } catch (error) {
    Log.Error("Error in SettingDeviceProperties15794: " + error.message);

  } finally {
    Log.PopLogFolder();
  }
}




